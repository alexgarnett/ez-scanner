{% extends 'base.html' %}

{% block content %}
    <div class="container">
        <div class="row">
            <div class="col-sm-2"></div>
            <div class="col-sm-8">
                <br>
                <p>Please hold your license up to the camera</p>
                <br>
                <p>Ensure that you are in a well lit area, and your license is centered in the screen</p>
            </div>
            <div class="col-sm-2"></div>
        </div>
        <div class="row" style="text-align:center;">
            <div class="hodler">
                <img src="{{ url_for('camera_feed') }}">
            </div>
        </div>
        <div class="row">
            <div class="col-sm-2"></div>
            <div class="col-sm-8">
                <form action="{{ url_for('review_image') }}" style="text-align: center;">
                    <input type="submit" value="Capture image">
                </form>
            </div>
            <div class="col-sm-2"></div>
        </div>
    </div>

    <script>
        const controls = document.querySelector('.controls');
        const cameraOptions = document.querySelector('.video-options>select');
        const video = document.querySelector('video');
        let streamStarted = false;

        const constraints = {
          video: {
            width: {
              ideal: 1080,
            },
            height: {
              ideal: 720,
            },
          }
        };

        const getCameraSelection = async () => {
          const devices = await navigator.mediaDevices.enumerateDevices();
          const videoDevices = devices.filter(device => device.kind === 'videoinput');
          const options = videoDevices.map(videoDevice => {
            return `<option value="${videoDevice.deviceId}">${videoDevice.label}</option>`;
          });
          cameraOptions.innerHTML = options.join('');
        };

        const startStream = async (constraints) => {
          const stream = await navigator.mediaDevices.getUserMedia(constraints);
          handleStream(stream);
        };

        const handleStream = (stream) => {
          video.srcObject = stream;
          streamStarted = true;
        };

        getCameraSelection();

        startStream(constraints);
    </script>
{% endblock %}